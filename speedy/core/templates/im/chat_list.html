{% extends 'base_site.html' %}

{% load core_tags_and_filters %}
{% load i18n %}
{% load im_tags %}
{% load user_tags %}

{% block title %}{% trans 'Messages' %} / {{ block.super }}{% endblock %}

{% block content %}

    <div class="page-header">
        <h1>{% trans 'Messages' %}</h1>
    </div>

    {% if chat_list %}
        {% annotate_chats_with_read_marks chat_list user %}
        {% for chat in chat_list %}
            {% get_other_participant chat user as entity %}
            <a class="text-default" href="{% url 'im:chat' chat_slug=chat|get_chat_slug:user %}">
                <div class="card  mb-4 bg-white {% if chat.is_unread %}border-primary{% endif %}">

                    <div class="card-body">
                        <div class="row">
                            <div class="col-1">
                                {% profile_picture entity '64x64' with_link=False html_class="img-fluid" %}
                            </div>
                            <div class="col-11">
                                <div>
                                    <strong>
                                        {{ entity.user }}
                                    </strong>
                                    <small>
                                        {{ chat.last_message.date_created }}
                                    </small>
                                    {% if chat.is_unread %}
                                        <span class="pull-right">
                                            <i class="fa fa-circle text-primary" title="{% trans 'Unread' %}"></i>
                                        </span>
                                    {% endif %}
                                </div>
                                <div>
                                    {% if user.id == chat.last_message.sender_id %}
                                        <strong><small>{% trans 'You:' context request.user.get_gender %}</small></strong>
                                    {% else %}
                                        {# <i class="fa fa-angle-right text-muted"></i> #}
                                    {% endif %}
                                    {{ chat.last_message.text|truncatechars:35 }}
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </a>
        {% endfor %}

        {% pagination %}

    {% else %}
        <div class="alert alert-warning">
            {% trans 'You have no messages yet.' context user.get_gender %}
        </div>
    {% endif %}

{% endblock %}

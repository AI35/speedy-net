{% extends 'profiles/user_base.html' %}

{% load crispy_forms_tags %}
{% load i18n %}
{% load im_tags %}
{% load thumbnail %}

{% block user_content %}
    {% get_other_participant chat user as other %}
    {% annotate_messages_with_read_marks message_list user %}
    <div class="well well-sm">
        <p>{% blocktrans with username=other.user %}Send a message to {{ username }}{% endblocktrans %}</p>
        {% crispy form %}
    </div>
    {% for message in message_list %}
        <div class="media well-sm {% if message.is_unread %}bg-success{% endif %}">
            <div class="media-left">
                {% thumbnail message.sender.user.profile_picture '42x42' crop='center' as im %}
                    {% if not link_to_chat %}<a href="{{ message.sender.user.get_absolute_url }}">{% endif %}
                        <img src="{{ im.url }}" alt="{{ user }}" width="{{ im.width }}" height="{{ im.height }}">
                    {% if not link_to_chat %}</a>{% endif %}
                {% endthumbnail %}
            </div>
            <div class="media-body">
                <div>
                    <a href="{{ message.sender.user.get_absolute_url }}">{{ message.sender.user }}</a>
                    <small class="text-muted">
                        {{ message.date_created }}
                    </small>
                </div>
                <div>
                    {{ message.text|linebreaksbr }}
                </div>
            </div>
        </div>
    {% endfor %}

{% endblock %}
